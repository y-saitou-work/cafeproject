こちらは完成版のコードです。
mainブランチを参照してください。
